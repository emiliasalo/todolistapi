<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Votes databank</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/api/resources/styles/style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/1000hz-bootstrap-validator/0.11.5/validator.js"></script>
	
	
	
	<!-- own scripts 
	<script src="api/resources/js/main.js"></script>
	<script src="api/resources/js/jquery-1.12.0.min.js"></script>
	pathing dont work -->	

</head>
<body>


<div class="container-full">



		<!-- Main component for a primary marketing message or call to action -->
	<div id="emptyspace">
		</div>
		
		<div id="emptyspace">
			<h1 id="thanks" class="text-center">Give grade!</h1>
		</div>
		<br>



		<div class="row">
			<div class="col-md-2 col-xs-2 col-md-offset-1 col-xs-offset-1">
				<button class="btn-block feeling" value="1">
					<img src="api/resources/images/1.png" class="img-responsive"
						alt="Smiley face">
				</button>
			</div>
			<div class="col-md-2 col-xs-2">
				<button class="btn-block feeling" value="2">
					<img src="api/resources/images/2.png" class="img-responsive"
						alt="Smiley face">
				</button>
			</div>
			<div class="col-md-2 col-xs-2">
				<button class="btn-block feeling" value="3">
					<img src="api/resources/images/3.png" class="img-responsive"
						alt="Smiley face">
				</button>
			</div>
			<div class="col-md-2 col-xs-2">
				<button class="btn-block feeling" value="4">
					<img src="api/resources/images/4.png" class="img-responsive"
						alt="Smiley face">
				</button>
			</div>
			<div class="col-md-2 col-xs-2">
				<button class="btn-block feeling" value="5">
					<img src="api/resources/images/5.png" class="img-responsive"
						alt="Smiley face">
				</button>
			</div>
		</div>
		<div id="emptyspace">
			<div class="row" id="numberrow">
				<div class="col-md-2 col-xs-2 col-md-offset-1 col-xs-offset-1">
					<h3 class="text-center">1</h3>
				</div>
				<div class="col-md-2 col-xs-2">
					<h3 class="text-center">2</h3>
				</div>
				<div class="col-md-2 col-xs-2">
					<h3 class="text-center">3</h3>
				</div>
				<div class="col-md-2 col-xs-2">
					<h3 class="text-center">4</h3>
				</div>
				<div class="col-md-2 col-xs-2">
					<h3 class="text-center">5</h3>
				</div>
			</div>
		</div>




		<div class="row">
			<div class="col-md-6 col-xs-10 col-md-offset-3 col-xs-offset-1">
				<button id="results" class="btn btn-primary btn-block">Show results</button>

				<h2 id="result" class="text-center"></h2>

				<br> <br> <br> <br> <br> <br> <br>
				<br> <br> <br> <br> <br> <br> <br>
				<br>
				
		<button class="btn btn-success btn-block" id="add">Add results to database</button>
			<br><br>
			<h1 class="text-center"><a href="results">Back to results</a></h1><br><br>
				<button id="reset" class="btn btn-primary btn-block">Reset</button>
			</div>
			</div>
			<!-- row ends -->




		</div>
		
		<!-- container ends -->




<!-- original code below -->
							<form>
  
  Smile1 <input id="smile1field" type="text" " value="">
  Smile2 <input id="smile2field" type="text" " value="">
  Smile3 <input id="smile3field" type="text" " value="">
  Smile4 <input id="smile4field" type="text" " value="">
  Smile5 <input id="smile5field" type="text" " value="">

 
</form>  
				<button id=buttoninsert type="button">Click Me!</button>
		
	
	<table class="table" id="smileytable">
					<thead>
						<tr>
							
							<th>Smile1:</th>
							<th>Smile2:</th>
							<th>Smile3:</th>
							<th>Smile4:</th>
							<th>Smile5:</th>
						</tr>
					</thead>
					<tbody>
						
					</tbody>
				</table>
				
		
</body>
<script>



//Make values that can be called
var pageurl = "/votes";
var data = "";

//adds values to tbody
$.getJSON(pageurl, function(result) {

	$.each(result, function(i, field) {
		// artistlist.push(field);
		console.log('smile1: ' + field.smile1 + ' smile2: ' + field.smile2 + ' smile3: '
				+ field.smile3 + ' smile4: ' + field.smile4 + ' smile5: ' + field.smile5);
		console.log(JSON.stringify(field));
		data += "<tr>";
		data += "<td>" + field.smile1 + "</td>";
		data += "<td>" + field.smile2 + "</td>";
		data += "<td>" + field.smile3 + "</td>";
		data += "<td>" + field.smile4 + "</td>";
		data += "<td>" + field.smile5 + "</td>";

		data += "</tr>";
	});
	$("tbody").html(data);
})

//AJAX method (creates "ajaxRequest" function which lets you access the data)

function ajaxRequests(data, type, callback) {
	$.ajax({
		url : '/votes',
		data : JSON.stringify(data),
		contentType : 'application/json',
		type : type,
		success : callback(),
		error : function(xhr, status, error) {
			console.log('Error: ' + error);
		},
	});
}

//inserts given data into the table
$("#buttoninsert").click(function() {
	var smile1 = $('#smile1field').val();
	var smile2 = $('#smile2field').val();
	var smile3 = $('#smile3field').val();
	var smile4 = $('#smile4field').val();
	var smile5 = $('#smile5field').val();
	// alert(name);
	var data = {
		"smile1" : smile1,
		"smile2" : smile2,
		"smile3" : smile3,
		"smile4" : smile4,
		"smile5" : smile5,
		
	};

	ajaxRequests(data, 'POST', function() {
//		if(data !== data){
//			console.log('Data not stored');
//		}else{
		console.log('Success: ' + "data added")
		console.log(JSON.stringify(data));
//		}
	});
});

//SMILEAPPLICATION CODE BELOW

$(document).ready(function() {
	
					var name = "";
					var ask = 0;
					ask = getCookie("askcookie");

					if (ask != 1) {
						var name = prompt("Name of the class:", "");
						setCookie("askcookie", 1, 365);
						setCookie("namecookie", name, 365);
					}

					// initial values
					var allpoints = 0;
					var votes = 0;
					var average = 0;
					var shown = 0;
					var points1 = 0;
					var points2 = 0;
					var points3 = 0;
					var points4 = 0;
					var points5 = 0;
					// if cookies got values, set them to variables
					average = getCookie("averagecookie");
					points1 = getCookie("points1cookie");
					points2 = getCookie("points2cookie");
					points3 = getCookie("points3cookie");
					points4 = getCookie("points4cookie");
					points5 = getCookie("points5cookie");
					allpoints = getCookie("allpointscookie");
					votes = getCookie("votescookie");
					name = getCookie("namecookie");

					$("#result").html(
							"Grades given: " + votes
									+ "<br><br> Average of the grades: "
									+ average + "<br> <br> " + points1
									+ "<br>" + points2 + "<br>" + points3
									+ "<br>" + points4 + "<br>" + points5);

					$("#result").hide();

					// adds feeling, depending on the value of the button
					$('.feeling')
							.click(
									function() {

										$('.feeling').prop("disabled", true);

										allpoints = Number(allpoints)
												+ Number($(this).val());

										if (Number($(this).val()) === 1) {
											points1 = Number(points1) + 1;

										} else if (Number($(this).val()) === 2) {
											points2 = Number(points2) + 1;
										} else if (Number($(this).val()) === 3) {
											points3 = Number(points3) + 1;
										} else if (Number($(this).val()) === 4) {
											points4 = Number(points4) + 1;
										} else if (Number($(this).val()) === 5) {
											points5 = Number(points5) + 1;
										}
										$(".feeling").hide();
										$("#numberrow").hide();
										$(this).show();

										votes = Number(votes) + 1

										$("#thanks").html("Thank you!").fadeIn(
												"fast");
										$("#thanks").css({
											"font-weight" : "bold",
											"font-size" : "80px",
											"color" : "red"
										});

										average = allpoints / votes;
										average = average.toFixed(2);

										setCookie("averagecookie", average,
												365);
										setCookie("votescookie", votes, 365);
										setCookie("points1cookie", points1,
												365);
										setCookie("points2cookie", points2,
												365);
										setCookie("points3cookie", points3,
												365);
										setCookie("points4cookie", points4,
												365);
										setCookie("points5cookie", points5,
												365);
										setCookie("allpointscookie",
												allpoints, 365);

										$("#result")
												.html(
														"Grades given: "
																+ votes
																+ "<br><br> Average of the grades: "
																+ average
																+ "<br> <br> "
																+ points1
																+ "<br>"
																+ points2
																+ "<br>"
																+ points3
																+ "<br>"
																+ points4
																+ "<br>"
																+ points5);
										setTimeout(changeText, 1000);

									});

					// shows "thank you"-text and returns the original text
					// back
					function changeText() {

						$("#thanks").fadeOut(function() {
							$(this).text("Give grade!").fadeIn("fast");
							$("#thanks").css({
								"font-weight" : "normal",
								"font-size" : "40px",
								"color" : "black"
							});
							$('.feeling').prop("disabled", false);
						});
						$(".feeling").fadeIn("slow");
						$("#numberrow").fadeIn("slow");

					}

					// shows results on page
					$('#results').click(function() {

						if (shown == 1) {
							$("#result").hide();
							shown = 0;
							$("#results").text("Show results");
						} else {
							$("#result").show();
							esilla = 1;
							$("#results").text("Hide results");
						}

					});

					

					// sets cookie
					function setCookie(cname, cvalue, exdays) {
						var d = new Date();
						d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
						var expires = "expires=" + d.toUTCString();
						document.cookie = cname + "=" + cvalue + "; " + expires;
					}
					// gets cookie
					function getCookie(cname) {
						var name = cname + "=";
						var ca = document.cookie.split(';');
						for (var i = 0; i < ca.length; i++) {
							var c = ca[i];
							while (c.charAt(0) == ' ')
								c = c.substring(1);
							if (c.indexOf(name) == 0)
								return c.substring(name.length, c.length);
						}
						return "";
					}
					// add grade to database
					$('#add').click(
							function() {
								var date = new Date();
								var pvm = date.getFullYear() + "-"
										+ (date.getMonth() + 1) + "-"
										+ date.getDate();

								var json = {
									"feeling1" : points1,
									"feeling2" : points2,
									"feeling3" : points3,
									"feeling4" : points4,
									"feeling5" : points5,
									"average" : average,
									"votes" : votes,
									"name" : name,
									"pvm" : pvm
								};

								$.ajax({
									url : "addresult",
									data : JSON.stringify(json),
									type : "POST",

									beforeSend : function(xhr) {
										xhr.setRequestHeader("Accept",
												"application/json");
										xhr.setRequestHeader("Content-Type",
												"application/json");
									}
								});

								alert("results added to database");
							});

				}); // document.ready ends




	
</script>
</html>